# ğŸ”„ ××¢×¨×›×ª ×”×—×–×¨×•×ª ×•×”×—×œ×¤×•×ª - ××¤×™×•×Ÿ ××œ×

## ğŸ“‹ ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª ×œ× ×™×”×•×œ ×‘×§×©×•×ª ×”×—×–×¨×” ×•×”×—×œ×¤×” ×©×œ ××•×¦×¨×™×, ×”×›×•×œ×œ×ª:
- **××–×•×¨ ×œ×§×•×—**: ×”×’×©×ª ×‘×§×©×•×ª ×”×—×–×¨×”/×”×—×œ×¤×”
- **×¢××•×“ ×¦×™×‘×•×¨×™**: ××“×™× ×™×•×ª ×”×—×–×¨×•×ª (×œ×¤×•×˜×¨)
- **××“××™×Ÿ**: × ×™×”×•×œ ×•××™×©×•×¨ ×‘×§×©×•×ª

---

## ğŸ¯ ×–×¨×™××ª ×”×ª×”×œ×™×š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ×œ×§×•×— ××’×™×© ×‘×§×©×”                               â”‚
â”‚  (×××–×•×¨ ××™×©×™ â†’ ×”×–×× ×•×ª â†’ ×‘×—×™×¨×ª ×¤×¨×™×˜ â†’ ×¡×™×‘×” â†’ ×¡×•×’ ×¤×ª×¨×•×Ÿ)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ×‘×§×©×” × ×•×¦×¨×ª ×‘×¡×˜×˜×•×¡ 'pending'                      â”‚
â”‚                    ×× ×”×œ ××§×‘×œ ×”×ª×¨××” (××™××™×™×œ/×“×©×‘×•×¨×“)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ×× ×”×œ ××˜×¤×œ ×‘×‘×§×©×”                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ××™×©×•×¨   â”‚   ×“×—×™×™×”  â”‚ ×‘×§×© ×¤×¨×˜×™×â”‚ ×”×—×œ×¤×”    â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ×¡×•×’ ×”×¤×ª×¨×•×Ÿ                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   ×”×—×œ×¤×”        â”‚    ×§×¨×“×™×˜       â”‚    ×–×™×›×•×™       â”‚               â”‚
â”‚  â”‚  (×”×–×× ×” ×—×“×©×”)  â”‚  (×œ×—× ×•×ª)       â”‚  (×œ×›×¨×˜×™×¡)      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ×¡×•×’×™ ×‘×§×©×•×ª

| ×¡×•×’ | ×ª×™××•×¨ | ×ª×•×¦××” |
|-----|-------|-------|
| **×”×—×–×¨×” (Return)** | ×œ×§×•×— ×¨×•×¦×” ×œ×”×—×–×™×¨ ××•×¦×¨ | ×–×™×›×•×™ ×›×¡×¤×™ / ×§×¨×“×™×˜ |
| **×”×—×œ×¤×” (Exchange)** | ×œ×§×•×— ×¨×•×¦×” ××•×¦×¨ ××—×¨ | ×”×–×× ×” ×—×“×©×” + ×–×™×›×•×™ ×¢×œ ×”××§×•×¨×™ |

---

## ğŸ’° ×¡×•×’×™ ×¤×ª×¨×•× ×•×ª (Resolution Types)

| ×¤×ª×¨×•×Ÿ | ×ª×™××•×¨ | ×¤×¢×•×œ×•×ª ×‘××¢×¨×›×ª |
|-------|-------|---------------|
| **exchange** | ×”×—×œ×¤×” ×¨××© ×‘×¨××© | ×™×•×¦×¨ ×”×–×× ×” ×—×“×©×”, ××—×–×™×¨ ××•×¦×¨ ×œ××œ××™ |
| **store_credit** | ×§×¨×“×™×˜ ×œ×—× ×•×ª | ××•×¡×™×£ ×§×¨×“×™×˜ ×œ×œ×§×•×—, ××—×–×™×¨ ××•×¦×¨ ×œ××œ××™ |
| **refund** | ×–×™×›×•×™ ×›×¡×¤×™ | ××–×›×” ×›×¨×˜×™×¡ ××©×¨××™*, ××—×–×™×¨ ××•×¦×¨ ×œ××œ××™ |
| **partial_refund** | ×–×™×›×•×™ ×—×œ×§×™ | ××–×›×” ×¡×›×•× ×—×œ×§×™ |

*×–×™×›×•×™ ×›×¡×¤×™ ×ª×œ×•×™ ×‘×¡×¤×§ ×”×ª×©×œ×•× (PayPlus ×•×›×•')

---

## ğŸ—„ï¸ ×¡×›××ª Database

### ×˜×‘×œ×”: `return_requests`

```typescript
returnRequests = pgTable('return_requests', {
  id: uuid('id').primaryKey().defaultRandom(),
  storeId: uuid('store_id').references(() => stores.id).notNull(),
  orderId: uuid('order_id').references(() => orders.id).notNull(),
  customerId: uuid('customer_id').references(() => customers.id).notNull(),
  
  // ××¡×¤×¨ ×‘×§×©×” ×™×™×—×•×“×™ ×œ×ª×¦×•×’×”
  requestNumber: varchar('request_number', { length: 20 }).notNull(),
  
  // ×¡×•×’ ×”×‘×§×©×”
  type: returnRequestTypeEnum('type').notNull(), // 'return' | 'exchange'
  
  // ×¡×˜×˜×•×¡
  status: returnRequestStatusEnum('status').default('pending').notNull(),
  // pending, under_review, approved, rejected, 
  // awaiting_shipment, item_received, completed, cancelled
  
  // ×¤×¨×™×˜×™× ×œ×‘×§×©×”
  items: jsonb('items').default([]),
  // [{ orderItemId, productId, variantId, name, quantity, price, reason, condition }]
  
  // ×¡×™×‘×ª ×”×”×—×–×¨×”
  reason: returnReasonEnum('reason').notNull(),
  // wrong_size, defective, not_as_described, changed_mind, wrong_item, other
  
  reasonDetails: text('reason_details'), // ×¤×¨×˜×™× × ×•×¡×¤×™× ××”×œ×§×•×—
  
  // ×ª××•× ×•×ª (×‘××§×¨×” ×©×œ ×¤×’×)
  images: jsonb('images').default([]), // [{ url, publicId }]
  
  // ×¡×•×’ ×”×¤×ª×¨×•×Ÿ ×”××‘×•×§×© ×¢"×™ ×”×œ×§×•×—
  requestedResolution: resolutionTypeEnum('requested_resolution').notNull(),
  // exchange, store_credit, refund
  
  // ×”×¤×ª×¨×•×Ÿ ×‘×¤×•×¢×œ (× ×§×‘×¢ ×¢"×™ ×”×× ×”×œ)
  finalResolution: resolutionTypeEnum('final_resolution'),
  resolutionDetails: jsonb('resolution_details'),
  // { exchangeOrderId, creditAmount, refundAmount, refundTransactionId }
  
  // ×¢×¨×›×™× ×›×¡×¤×™×™×
  totalValue: decimal('total_value', { precision: 10, scale: 2 }).notNull(),
  refundAmount: decimal('refund_amount', { precision: 10, scale: 2 }),
  creditIssued: decimal('credit_issued', { precision: 10, scale: 2 }),
  
  // ×”×–×× ×ª ×”×—×œ×¤×” (×× ×¨×œ×•×•× ×˜×™)
  exchangeOrderId: uuid('exchange_order_id').references(() => orders.id),
  
  // ××¢×§×‘ ××©×œ×•×— ×”×—×–×¨×”
  returnTrackingNumber: varchar('return_tracking_number', { length: 100 }),
  returnCarrier: varchar('return_carrier', { length: 50 }),
  itemReceivedAt: timestamp('item_received_at'),
  
  // ×”×¢×¨×•×ª ×¤× ×™××™×•×ª
  internalNotes: text('internal_notes'),
  customerNotes: text('customer_notes'), // ×”×•×“×¢×•×ª ×œ×œ×§×•×—
  
  // ××™ ×˜×™×¤×œ
  processedById: uuid('processed_by_id').references(() => users.id),
  processedAt: timestamp('processed_at'),
  
  // ×ª××¨×™×›×™×
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});
```

### Enums ×—×“×©×™×

```typescript
// ×¡×•×’ ×‘×§×©×”
export const returnRequestTypeEnum = pgEnum('return_request_type', [
  'return',    // ×”×—×–×¨×”
  'exchange'   // ×”×—×œ×¤×”
]);

// ×¡×˜×˜×•×¡ ×‘×§×©×”
export const returnRequestStatusEnum = pgEnum('return_request_status', [
  'pending',           // ×××ª×™×Ÿ ×œ×‘×“×™×§×”
  'under_review',      // ×‘×‘×“×™×§×”
  'approved',          // ××•×©×¨
  'rejected',          // × ×“×—×”
  'awaiting_shipment', // ×××ª×™×Ÿ ×œ×©×œ×™×—×ª ×”××•×¦×¨
  'item_received',     // ×”××•×¦×¨ ×”×ª×§×‘×œ
  'completed',         // ×”×•×©×œ×
  'cancelled'          // ×‘×•×˜×œ
]);

// ×¡×™×‘×ª ×”×—×–×¨×”
export const returnReasonEnum = pgEnum('return_reason', [
  'wrong_size',        // ××™×“×” ×œ× ××ª××™××”
  'defective',         // ×¤×’× ×‘××•×¦×¨
  'not_as_described',  // ×œ× ×›××ª×•××¨
  'changed_mind',      // ×©×™× ×•×™ ×“×¢×”
  'wrong_item',        // ×§×™×‘×œ×ª×™ ××•×¦×¨ ×©×’×•×™
  'damaged_shipping',  // × ×–×§ ×‘××©×œ×•×—
  'other'              // ××—×¨
]);

// ×¡×•×’ ×¤×ª×¨×•×Ÿ
export const resolutionTypeEnum = pgEnum('resolution_type', [
  'exchange',          // ×”×—×œ×¤×” ×¨××© ×‘×¨××©
  'store_credit',      // ×§×¨×“×™×˜ ×œ×—× ×•×ª
  'refund',           // ×–×™×›×•×™ ×›×¡×¤×™ ××œ×
  'partial_refund'     // ×–×™×›×•×™ ×—×œ×§×™
]);
```

---

## ğŸ“± ××¡×›×™×

### 1. ××–×•×¨ ×œ×§×•×— - ×”×’×©×ª ×‘×§×©×”

**× ×ª×™×‘**: `/shops/[slug]/account/orders/[orderNumber]/return`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ×—×–×¨×” ×œ×”×–×× ×” #1234                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ“¦ ×‘×§×©×ª ×”×—×–×¨×”/×”×—×œ×¤×”                                               â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                     â”‚
â”‚  ×‘×—×¨ ×¤×¨×™×˜×™× ×œ×”×—×–×¨×”:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜‘ ×—×•×œ×¦×” ×›×—×•×œ×” - ××™×“×” M                    â‚ª199    ×›××•×ª: 1  â”‚   â”‚
â”‚  â”‚ â˜ ××›× ×¡×™×™× ×©×—×•×¨×™× - ××™×“×” L                 â‚ª299    ×›××•×ª: 2  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ×¡×™×‘×ª ×”×”×—×–×¨×”:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ â–¼ ××™×“×” ×œ× ××ª××™××”                        â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                     â”‚
â”‚  ×¤×¨×˜×™× × ×•×¡×¤×™× (××•×¤×¦×™×•× ×œ×™):                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚                                         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                     â”‚
â”‚  ××” ×ª×¨×¦×” ×œ×§×‘×œ?                                                     â”‚
â”‚  â—‹ ×”×—×œ×¤×” ×œ××•×¦×¨ ××—×¨                                                 â”‚
â”‚  â— ×§×¨×“×™×˜ ×œ×—× ×•×ª                                                     â”‚
â”‚  â—‹ ×–×™×›×•×™ ×›×¡×¤×™                                                      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              ×©×œ×— ×‘×§×©×”                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ××–×•×¨ ×œ×§×•×— - ×¨×©×™××ª ×‘×§×©×•×ª

**× ×ª×™×‘**: `/shops/[slug]/account/returns`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ×”×‘×§×©×•×ª ×©×œ×™                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ×‘×§×©×” #R1001                          01.01.2026              â”‚ â”‚
â”‚  â”‚ ×”×–×× ×” #1234                                                  â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ ×—×•×œ×¦×” ×›×—×•×œ×” x1 - â‚ª199                                   â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚ ×¡×˜×˜×•×¡: ğŸŸ¡ ×××ª×™×Ÿ ×œ××™×©×•×¨                                      â”‚ â”‚
â”‚  â”‚ ×¡×•×’: ×”×—×–×¨×” â†’ ×§×¨×“×™×˜ ×œ×—× ×•×ª                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ×‘×§×©×” #R1000                          28.12.2025              â”‚ â”‚
â”‚  â”‚ ×”×–×× ×” #1198                                                  â”‚ â”‚
â”‚  â”‚ ×¡×˜×˜×•×¡: ğŸŸ¢ ×”×•×©×œ× - ×§×¨×“×™×˜ â‚ª350 ×”×•×–×Ÿ ×œ×—×©×‘×•×Ÿ                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ×¢××•×“ ×¦×™×‘×•×¨×™ - ××“×™× ×™×•×ª ×”×—×–×¨×•×ª

**× ×ª×™×‘**: `/shops/[slug]/pages/returns-policy`

(×“×£ ×ª×•×›×Ÿ ×¡×˜×˜×™ ×©× ×™×ª×Ÿ ×œ×¢×¨×™×›×” ××”××“××™×Ÿ)

### 4. ××“××™×Ÿ - ×¨×©×™××ª ×‘×§×©×•×ª

**× ×ª×™×‘**: `/shops/[slug]/admin/returns`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ×”×—×–×¨×•×ª ×•×”×—×œ×¤×•×ª                                    + ×”×•×¡×¤×” ×™×“× ×™×ª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ×”×›×œ (25) â”‚ ×××ª×™× ×•×ª (5) â”‚ ×‘×˜×™×¤×•×œ (3) â”‚ ×”×•×©×œ××• (15) â”‚ × ×“×—×• (2) â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  ğŸ” ×—×™×¤×•×©...                                                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ××¡' ×‘×§×©×”  â”‚ ×”×–×× ×”  â”‚ ×œ×§×•×—      â”‚ ×¡×•×’    â”‚ ×¡×›×•×   â”‚ ×¡×˜×˜×•×¡  â”‚ ×ª××¨×™×š â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ R1001    â”‚ #1234  â”‚ ×™×©×¨××œ ×›×”×Ÿ â”‚ ×”×—×–×¨×”  â”‚ â‚ª199  â”‚ ğŸŸ¡     â”‚ 01.01 â”‚
â”‚  â”‚ R1000    â”‚ #1198  â”‚ ×©×¨×” ×œ×•×™   â”‚ ×”×—×œ×¤×”  â”‚ â‚ª450  â”‚ ğŸŸ¢     â”‚ 28.12 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. ××“××™×Ÿ - ×¤×¨×˜×™ ×‘×§×©×” + ×¤×¢×•×œ×•×ª

**× ×ª×™×‘**: `/shops/[slug]/admin/returns/[id]`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ×—×–×¨×” ×œ×¨×©×™××”                            ×‘×§×©×” #R1001             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ×¤×¨×˜×™ ×”×‘×§×©×”                          â”‚ â”‚ ×¤×¢×•×œ×•×ª                  â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚                         â”‚â”‚
â”‚  â”‚ ×¡×•×’: ×”×—×–×¨×”                          â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚ ×¡×™×‘×”: ××™×“×” ×œ× ××ª××™××”               â”‚ â”‚ â”‚    âœ“ ××©×¨ ×‘×§×©×”      â”‚ â”‚â”‚
â”‚  â”‚ ×¡×›×•×: â‚ª199                         â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚ ×ª××¨×™×š: 01.01.2026                  â”‚ â”‚                         â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚ ×¤×ª×¨×•×Ÿ ××‘×•×§×©: ×§×¨×“×™×˜ ×œ×—× ×•×ª           â”‚ â”‚ â”‚    âœ— ×“×—×” ×‘×§×©×”      â”‚ â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚ â”‚                         â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ ×‘×—×¨ ×¤×ª×¨×•×Ÿ:             â”‚â”‚
â”‚  â”‚ ×¤×¨×™×˜×™×:                             â”‚ â”‚ â—‹ ×”×—×œ×¤×”               â”‚â”‚
â”‚  â”‚ â€¢ ×—×•×œ×¦×” ×›×—×•×œ×” M x1 - â‚ª199         â”‚ â”‚ â— ×§×¨×“×™×˜               â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ â—‹ ×–×™×›×•×™ ×›×¡×¤×™          â”‚â”‚
â”‚  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚ â”‚                         â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ ×¡×›×•×: â‚ª199            â”‚â”‚
â”‚  â”‚ ×œ×§×•×—: ×™×©×¨××œ ×›×”×Ÿ                    â”‚ â”‚                         â”‚â”‚
â”‚  â”‚ ×”×–×× ×” ××§×•×¨×™×ª: #1234                â”‚ â”‚ ×”×¢×¨×•×ª ×œ×œ×§×•×—:           â”‚â”‚
â”‚  â”‚                                     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                   â”‚  â”‚â”‚
â”‚                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚â”‚
â”‚  â”‚ ×”×™×¡×˜×•×¨×™×™×ª ×¤×¢×•×œ×•×ª                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                     â”‚                           â”‚
â”‚  â”‚ 01.01 09:30 - ×‘×§×©×” × ×•×¦×¨×”          â”‚                           â”‚
â”‚  â”‚ 01.01 14:15 - ×”×ª×§×‘×œ×” ×œ×‘×“×™×§×”       â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ×œ×•×’×™×§×” ×¢×¡×§×™×ª

### 1. ×™×¦×™×¨×ª ×‘×§×©×ª ×”×—×–×¨×” (×œ×§×•×—)

```typescript
async function createReturnRequest(data: CreateReturnRequestInput) {
  // 1. ×•×™×“×•× ×©×”×”×–×× ×” ×©×™×™×›×ª ×œ×œ×§×•×—
  // 2. ×•×™×“×•× ×©×”×¤×¨×™×˜×™× ×§×™×™××™× ×‘×”×–×× ×”
  // 3. ×‘×“×™×§×ª ×ª×•×§×£ (××“×™× ×™×•×ª ×”×—×–×¨×•×ª - X ×™××™×)
  // 4. ×™×¦×™×¨×ª ××¡×¤×¨ ×‘×§×©×” ×™×™×—×•×“×™ (R1001, R1002...)
  // 5. ×©××™×¨×” ×‘×¡×˜×˜×•×¡ 'pending'
  // 6. ×©×œ×™×—×ª ×”×ª×¨××” ×œ×× ×”×œ
  // 7. ×©×œ×™×—×ª ××™××™×™×œ ×œ×œ×§×•×— ×¢× ××™×©×•×¨ ×§×‘×œ×”
}
```

### 2. ××™×©×•×¨ ×‘×§×©×” (×× ×”×œ)

```typescript
async function approveReturnRequest(
  requestId: string,
  resolution: 'exchange' | 'store_credit' | 'refund',
  options: {
    amount?: number;
    exchangeProductId?: string;
    exchangeVariantId?: string;
    notes?: string;
  }
) {
  // 1. ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×œ-'approved'
  // 2. ×œ×¤×™ ×¡×•×’ ×”×¤×ª×¨×•×Ÿ:
  
  if (resolution === 'exchange') {
    // ×™×¦×™×¨×ª ×”×–×× ×” ×—×“×©×” ×¢× ×”××•×¦×¨ ×”×—×“×©
    // ×”×–×× ×” ×‘×¡×›×•× 0 (××• ×”×¤×¨×© ×× ×™×§×¨ ×™×•×ª×¨)
    // ×¡×™××•×Ÿ exchangeOrderId ×‘×‘×§×©×”
    // ×”×•×¨×“×” ××”××œ××™ ×©×œ ×”××•×¦×¨ ×”×—×“×©
  }
  
  if (resolution === 'store_credit') {
    // ×”×•×¡×¤×ª ×§×¨×“×™×˜ ×œ×—×©×‘×•×Ÿ ×”×œ×§×•×—
    // ×™×¦×™×¨×ª ×¨×©×•××ª creditTransaction
  }
  
  if (resolution === 'refund') {
    // ×‘×™×¦×•×¢ ×–×™×›×•×™ ×‘×¡×¤×§ ×”×ª×©×œ×•× (PayPlus refund API)
    // ×× ×œ× × ×™×ª×Ÿ - ×”×¦×’×ª ×©×’×™××”
  }
  
  // 3. ×”×—×–×¨×ª ×”×¤×¨×™×˜×™× ×œ××œ××™
  // 4. ×©×œ×™×—×ª ××™××™×™×œ ×œ×œ×§×•×—
}
```

### 3. ×”×—×–×¨×ª ××•×¦×¨ ×œ××œ××™

```typescript
async function returnItemToInventory(
  productId: string,
  variantId?: string,
  quantity: number
) {
  // ×× ×™×© ×•×¨×™×× ×˜ - ×¢×“×›×•×Ÿ ××œ××™ ×”×•×¨×™×× ×˜
  // ××—×¨×ª - ×¢×“×›×•×Ÿ ××œ××™ ×”××•×¦×¨ ×”×¨××©×™
  
  if (variantId) {
    await db.update(productVariants)
      .set({ inventory: sql`inventory + ${quantity}` })
      .where(eq(productVariants.id, variantId));
  } else {
    await db.update(products)
      .set({ inventory: sql`inventory + ${quantity}` })
      .where(eq(products.id, productId));
  }
}
```

### 4. ×™×¦×™×¨×ª ×”×–×× ×ª ×”×—×œ×¤×”

```typescript
async function createExchangeOrder(
  returnRequest: ReturnRequest,
  newProductId: string,
  newVariantId?: string
) {
  // 1. ×—×™×©×•×‘ ×”×¤×¨×© ××—×™×¨
  const originalValue = returnRequest.totalValue;
  const newProductPrice = await getProductPrice(newProductId, newVariantId);
  const priceDifference = newProductPrice - originalValue;
  
  // 2. ×™×¦×™×¨×ª ×”×–×× ×” ×—×“×©×”
  const newOrder = await db.insert(orders).values({
    storeId: returnRequest.storeId,
    customerId: returnRequest.customerId,
    status: 'confirmed',
    financialStatus: priceDifference <= 0 ? 'paid' : 'pending',
    subtotal: newProductPrice,
    discountAmount: originalValue, // ×”×”×—×–×¨×” ×›×”× ×—×”
    total: Math.max(0, priceDifference),
    // ... ×©××¨ ×”×¤×¨×˜×™× ××”×”×–×× ×” ×”××§×•×¨×™×ª
    notes: `×”×—×œ×¤×” ××”×–×× ×” #${originalOrder.orderNumber}`,
  });
  
  // 3. ×™×¦×™×¨×ª ×¤×¨×™×˜×™ ×”×–×× ×”
  await db.insert(orderItems).values({
    orderId: newOrder.id,
    productId: newProductId,
    // ...
  });
  
  // 4. ×”×•×¨×“×” ××”××œ××™
  await decrementInventory([{ productId: newProductId, variantId: newVariantId, quantity: 1 }]);
  
  // 5. ×¢×“×›×•×Ÿ ×”×‘×§×©×” ×¢× ××–×”×” ×”×”×–×× ×” ×”×—×“×©×”
  await db.update(returnRequests)
    .set({ exchangeOrderId: newOrder.id })
    .where(eq(returnRequests.id, returnRequest.id));
    
  return newOrder;
}
```

---

## ğŸ“§ ××™××™×™×œ×™×

| ××™×¨×•×¢ | × ××¢×Ÿ | ×ª×•×›×Ÿ |
|-------|------|------|
| ×‘×§×©×” × ×•×¦×¨×” | ×œ×§×•×— | "×‘×§×©×ª×š ×”×ª×§×‘×œ×”, ××¡×¤×¨: R1001" |
| ×‘×§×©×” × ×•×¦×¨×” | ×× ×”×œ | "×‘×§×©×ª ×”×—×–×¨×” ×—×“×©×” ×××ª×™× ×” ×œ××™×©×•×¨" |
| ×‘×§×©×” ××•×©×¨×” | ×œ×§×•×— | "×‘×§×©×ª×š ××•×©×¨×”! [×¤×¨×˜×™ ×”×¤×ª×¨×•×Ÿ]" |
| ×‘×§×©×” × ×“×—×ª×” | ×œ×§×•×— | "×‘×§×©×ª×š × ×“×—×ª×”. ×¡×™×‘×”: [...]" |
| ×§×¨×“×™×˜ × ×™×ª×Ÿ | ×œ×§×•×— | "×§×™×‘×œ×ª ×§×¨×“×™×˜ ×©×œ â‚ªX ×œ×—× ×•×ª" |
| ×”×—×œ×¤×” × ×•×¦×¨×” | ×œ×§×•×— | "×”×–×× ×ª ×”×”×—×œ×¤×” ×©×œ×š: #XXXX" |

---

## ğŸ”’ ×”×¨×©××•×ª

| ×¤×¢×•×œ×” | ×œ×§×•×— | ×× ×”×œ |
|-------|------|------|
| ×¦×¤×™×™×” ×‘×‘×§×©×•×ª ×©×œ×™ | âœ… | âœ… |
| ×™×¦×™×¨×ª ×‘×§×©×” | âœ… | âœ… |
| ×‘×™×˜×•×œ ×‘×§×©×” | âœ… (×œ×¤× ×™ ××™×©×•×¨) | âœ… |
| ××™×©×•×¨/×“×—×™×™×ª ×‘×§×©×” | âŒ | âœ… |
| ×‘×—×™×¨×ª ×¡×•×’ ×¤×ª×¨×•×Ÿ | âŒ | âœ… |
| ×¦×¤×™×™×” ×‘×›×œ ×”×‘×§×©×•×ª | âŒ | âœ… |

---

## âš¡ ×‘×™×¦×•×¢×™× (REQUIREMENTS.md)

### Server Components (80%+)
- ×“×¤×™ ×¨×©×™××•×ª = Server Components
- ×˜×‘×œ××•×ª = Server Components ×¢× pagination
- ×¤×¨×˜×™ ×‘×§×©×” = Server Component

### Client Components (×¨×§ ×”×›×¨×—×™)
- ×˜×•×¤×¡ ×™×¦×™×¨×ª ×‘×§×©×”
- ×›×¤×ª×•×¨×™ ××™×©×•×¨/×“×—×™×™×”
- ×¡×œ×§×˜×•×¨ ××•×¦×¨×™× ×œ×”×—×œ×¤×”

### ××•×¤×˜×™××™×–×¦×™×•×ª
- `cache()` ×œ×§×¨×™××•×ª DB
- `revalidatePath()` ××—×¨×™ ×¤×¢×•×œ×•×ª
- ISR ×œ×¢××•×“ ××“×™× ×™×•×ª ×”×—×–×¨×•×ª
- Prefetch ×œ×“×¤×™× × ×¤×•×¦×™×

---

## ğŸ“ ××‘× ×” ×§×‘×¦×™×

```
src/
â”œâ”€â”€ app/shops/[slug]/
â”‚   â”œâ”€â”€ (storefront)/
â”‚   â”‚   â”œâ”€â”€ account/
â”‚   â”‚   â”‚   â”œâ”€â”€ returns/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ×¨×©×™××ª ×‘×§×©×•×ª ×”×œ×§×•×—
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [requestId]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx          # ×¤×¨×˜×™ ×‘×§×©×”
â”‚   â”‚   â”‚   â””â”€â”€ orders/
â”‚   â”‚   â”‚       â””â”€â”€ [orderNumber]/
â”‚   â”‚   â”‚           â””â”€â”€ return/
â”‚   â”‚   â”‚               â””â”€â”€ page.tsx      # ×˜×•×¤×¡ ×™×¦×™×¨×ª ×‘×§×©×”
â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”‚       â””â”€â”€ returns-policy/
â”‚   â”‚           â””â”€â”€ page.tsx              # ×¢××•×“ ××“×™× ×™×•×ª ×”×—×–×¨×•×ª
â”‚   â”‚
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ returns/
â”‚           â”œâ”€â”€ page.tsx                  # ×¨×©×™××ª ×›×œ ×”×‘×§×©×•×ª
â”‚           â”œâ”€â”€ returns-data-table.tsx    # ×˜×‘×œ×” + ×¤×¢×•×œ×•×ª
â”‚           â”œâ”€â”€ [id]/
â”‚           â”‚   â””â”€â”€ page.tsx              # ×¤×¨×˜×™ ×‘×§×©×” + ×˜×™×¤×•×œ
â”‚           â””â”€â”€ actions.ts                # Server Actions
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ db/
â”‚       â””â”€â”€ queries/
â”‚           â””â”€â”€ returns.ts                # ×©××™×œ×ª×•×ª ×”×—×–×¨×•×ª
â”‚
â””â”€â”€ components/
    â””â”€â”€ returns/
        â”œâ”€â”€ return-request-form.tsx       # ×˜×•×¤×¡ ×™×¦×™×¨×ª ×‘×§×©×” (Client)
        â”œâ”€â”€ return-resolution-form.tsx    # ×˜×•×¤×¡ ××™×©×•×¨ (Client)
        â””â”€â”€ product-exchange-picker.tsx   # ×‘×—×™×¨×ª ××•×¦×¨ ×œ×”×—×œ×¤×” (Client)
```

---

## ğŸš€ ×©×œ×‘×™ ××™××•×©

### Phase 1: DB + ×¡×›××”
1. ×™×¦×™×¨×ª Enums ×—×“×©×™×
2. ×™×¦×™×¨×ª ×˜×‘×œ×ª `return_requests`
3. Relations
4. Migration

### Phase 2: ××–×•×¨ ×œ×§×•×—
1. ×˜×•×¤×¡ ×™×¦×™×¨×ª ×‘×§×©×”
2. ×¨×©×™××ª ×”×‘×§×©×•×ª ×©×œ×™
3. ×¦×¤×™×™×” ×‘×¤×¨×˜×™ ×‘×§×©×”

### Phase 3: ××“××™×Ÿ
1. ×¨×©×™××ª ×›×œ ×”×‘×§×©×•×ª + ×˜××‘×™×
2. ×˜×™×¤×•×œ ×‘×‘×§×©×” ×‘×•×“×“×ª
3. ×¤×¢×•×œ×•×ª: ××™×©×•×¨/×“×—×™×™×”/×”×—×œ×¤×”

### Phase 4: ×œ×•×’×™×§×” ×¢×¡×§×™×ª
1. ×”×—×–×¨×” ×œ××œ××™
2. ×™×¦×™×¨×ª ×§×¨×“×™×˜
3. ×™×¦×™×¨×ª ×”×–×× ×ª ×”×—×œ×¤×”
4. ×–×™×›×•×™ ×›×¡×¤×™ (PayPlus API)

### Phase 5: ××™××™×™×œ×™× + ×”×ª×¨××•×ª
1. ×ª×‘× ×™×•×ª ××™××™×™×œ
2. ×”×ª×¨××•×ª ×“×©×‘×•×¨×“
3. ×¢×“×›×•× ×™ ×¡×˜×˜×•×¡










